<html>
<head>
<body>
<canvas id="canvas" style="border: 1px solid black" width="640" height="640"></canvas>
<div id="palette"></div>
</body>
<script>

(function() {
  var canvas = document.getElementById("canvas");
  var cx = canvas.getContext('2d');

  var lastx = 0;
  var lasty = 0;
  var lastdown = false;

  var putpixel = function(e) {
    if (!e.buttons) { lastdown = false; return; }
    var newx = Math.floor(e.clientX - canvas.offsetLeft)/10;
    var newy = Math.floor(e.clientY - canvas.offsetTop)/10;
    if (lastdown) {
      var veclen = Math.sqrt((newx-lastx)*(newx-lastx)+(newy-lasty)*(newy-lasty));
      var vx = (newx-lastx)/veclen;
      var vy = (newy-lasty)/veclen;
      
      for (var t = 0; t <= veclen; t++) {
        var x = Math.floor(vx*t + lastx)*10;
        var y = Math.floor(vy*t + lasty)*10;
        cx.fillRect(x, y, 10, 10);
      }
      lastx = newx;
      lasty = newy;
    }
    else {
      var x = Math.floor(newx)*10;
      var y = Math.floor(newy)*10;
      cx.fillRect(x, y, 10, 10);
      lastx = newx;
      lasty = newy;
      lastdown = true;
    }
  };

  canvas.addEventListener('mousedown', putpixel);
  canvas.addEventListener('mousemove', putpixel);
  canvas.addEventListener('mouseup', putpixel);

  var palette = document.getElementById("palette");
  var paletteColors = [ 
    "#000000",
    "#0000ff",
    "#00ff00",
    "#00ffff",
    "#ff0000",
    "#ff00ff",
    "#ffff00",
    "#ffffff" ];

  for (var i = 0; i < paletteColors.length; i++) {
    (function() {
      var entry = document.createElement("span");
      var color = paletteColors[i];
      entry.setAttribute("style", 
        "display: inline-block; width: 50px; height: 50px; border: 1px solid black; background-color: " + color);
      entry.addEventListener("click", function(e) {
        cx.fillStyle = color;
      });
      document.body.appendChild(entry);
    })();
  }
})();
</script>
</html>
