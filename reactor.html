<html>
<head>
<script src="jquery-3.3.1.js"></script>
<script src="utils.js"></script>
<script src="reactor.js"></script>
<script src="laboratory.js"></script>
<script src="https://www.gstatic.com/firebasejs/4.13.0/firebase.js"></script>
<!-- <script src="https://www.gstatic.com/firebasejs/4.13.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/4.13.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/4.13.0/firebase-database.js"></script>
-->
<script src="https://www.gstatic.com/firebasejs/4.13.0/firebase-firestore.js"></script>
<!--
<script src="https://www.gstatic.com/firebasejs/4.13.0/firebase-messaging.js"></script>
<script src="https://www.gstatic.com/firebasejs/4.13.0/firebase-functions.js"></script>
<script src="https://www.gstatic.com/firebasejs/4.13.0/firebase-storage.js"></script>
-->
<script>
  // Initialize Firebase
  var config = {
    apiKey: "AIzaSyBjpYowQZ1sewFmHEJl9ZDfDx20rsQ_tZQ",
    authDomain: "doodle-chemist.firebaseapp.com",
    databaseURL: "https://doodle-chemist.firebaseio.com",
    projectId: "doodle-chemist",
    storageBucket: "doodle-chemist.appspot.com",
    messagingSenderId: "1086839312639"
  };
  firebase.initializeApp(config);

  // "element1:element2" : {  // element1 <= element2
  //   demand: <nat>
  //   results: {
  //     element3: <nat>
  //     element4: <nat>
  //     ...
  //   }
  var db = firebase.firestore();
  db.settings({timestampsInSnapshots: true});

  $(function() {
    var utils = Utils({});

    var refreshReactor = function() {
      $('#editor').empty();
      reactor.refresh();
    };

    var reactor = Reactor({
      container: $('#reactor')[0],
      database: db,
      onMatch: function(element) {
        $('#editor').text(element);
        utils.delay(2000).then(refreshReactor);
      },
      onNoMatch: function() {
        $('#editor').text("No match");
        utils.delay(2000).then(refreshReactor);
      },
      utils: utils
    });

    var laboratory = Laboratory({
      container: $('#laboratory')[0],
      database: db,
      utils: utils
    });
    
    reactor.refresh();
    laboratory.refresh();
  });

</script>
</head>
<body>
<div id="reactor"></div>
<div id="editor"></div>
<div id="laboratory"></div>
</body>
</html>
